<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IABox - Painel</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f3f4f6;padding:28px}
    .wrap{max-width:900px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.06)}
    h1{margin:0 0 8px}
    textarea{width:100%;height:120px;padding:10px;border-radius:8px;border:1px solid #e5e7eb;font-size:13px}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button, a.book{background:#2563eb;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;text-decoration:none}
    a.book{background:#10b981}
    .note{color:#374151;margin-top:10px}
    code{background:#eef2ff;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üöÄ IABox - Gerador de Snippet</h1>
    <p class="note">Copie o c√≥digo abaixo e cole no seu site antes de <code>&lt;/body&gt;</code>, ou arraste o bot√£o para a barra de favoritos (bookmarklet).</p>

    <label><strong>Snippet para copiar (cole antes de &lt;/body&gt;):</strong></label>
    <textarea id="codigo" readonly></textarea>

    <div class="row">
      <button id="btnCopy">üìã Copiar c√≥digo</button>
      <button id="btnGen">üîÅ Gerar novo snippet</button>
      <a id="dragBtn" class="book" href="#">IABox üöÄ (arraste-me)</a>
    </div>

    <p class="note" id="status">Status: pronto</p>
  </div>

  <script>
    // === TROCA S√ì SE SUA URL FOR DIFERENTE ===
    const SCRIPT_URL = "https://teste-egal-e-ofical-da-parada-c1e014bdi-betaodopedacos-projects.vercel.app/iabox.js";
    // =========================================

    // Gera siteId simples (n√£o precisa backend por enquanto)
    function gerarSiteId(){
      return 'site-' + Math.random().toString(36).slice(2,10);
    }

    // Monta snippet completo (URL absoluta + init para garantir carregamento)
    function montarSnippet(siteId){
      // Se quiser s√≥ o <script src="..."></script> substitua por essa linha simples.
      return `<script>(function(w,d){if(w.__iabox_loaded)return;w.__iabox_loaded=true;var s=d.createElement('script');s.src='${SCRIPT_URL}';s.async=true;s.onload=function(){try{if(window.IABox && window.IABox.init){window.IABox.init({siteId:'${siteId}',position:'bottom-right',theme:'auto'});} }catch(e){console.error(e);}};d.body.appendChild(s);})(window,document);</script>`;
    }

    // Monta bookmarklet (usa URL absoluta)
    function montarBookmarklet(siteId){
      // encodeURIComponent n√£o √© necess√°rio aqui mas manter simples
      const body = `if(window.__iabox_loaded){}else{window.__iabox_loaded=true;var s=document.createElement('script');s.src='${SCRIPT_URL}';s.async=true;s.onload=function(){try{if(window.IABox && window.IABox.init){window.IABox.init({siteId:'${siteId}',position:'bottom-right',theme:'auto'});} }catch(e){console.error(e);}};document.body.appendChild(s);}`;
      return 'javascript:(function(){' + body + '})();';
    }

    // Expor fun√ß√µes no window para garantir escopo global (evita copyText undefined)
    window.copyText = function(elId){
      const el = document.getElementById(elId);
      if(!el) return alert('Elemento n√£o encontrado');
      const text = el.value || el.innerText;
      navigator.clipboard.writeText(text).then(()=>{
        alert('Copiado para o clipboard!');
      }).catch(err=>{
        // fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try{ document.execCommand('copy'); alert('Copiado!'); }catch(e){ alert('Erro ao copiar'); }
        ta.remove();
      });
    };

    // Gera√ß√£o inicial
    function gerarEAtualizar(){
      const id = gerarSiteId();
      const snippet = montarSnippet(id);
      const bookmarklet = montarBookmarklet(id);

      document.getElementById('codigo').value = snippet;
      const drag = document.getElementById('dragBtn');
      drag.setAttribute('href', bookmarklet);
      drag.setAttribute('title', 'Arraste para a barra de favoritos para criar o bookmarklet IABox');
      document.getElementById('status').innerText = 'Status: snippet gerado ‚Äî Site ID: ' + id;
    }

    // Eventos dos bot√µes
    document.getElementById('btnCopy').addEventListener('click', function(){ window.copyText('codigo'); });
    document.getElementById('btnGen').addEventListener('click', gerarEAtualizar);

    // Gera on load
    gerarEAtualizar();
  </script>
</body>
</html>
